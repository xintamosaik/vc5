<!DOCTYPE html>
<html lang="en" style="background-color: black; color: white">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VC5</title>
    <meta name="description" content="A simple editor for CVs" />
    <style>
      * {
        box-sizing: border-box;
      }
      nav {
        display: flex;
        flex-direction: row;
        gap: 1rem;
        align-items: flex-start;
      }

      main {
        padding: 1rem;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      #preview,
      #editor {
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      #editor > div {
        flex-direction: column;
        gap: 1rem;
      }

      button {
        border: 1px solid white;
        background-color: black;
        color: white;
        padding: 1rem 2rem;
        box-shadow: 0.5ch 0.5ch 0 white;
      }

      input {
        outline: none;
        border: none;
        border-bottom: 1px solid white;
        background-color: black;
        color: white;
        padding: 0.5rem 1rem;
      }
    </style>
     <script>
      function navigate(event) {
        const target = event.target;
        if (target.tagName !== "BUTTON") return;

        const navigation = target.closest("nav");
        if (!navigation) return;

        const sectionName = navigation.dataset.section;
        if (!sectionName) return;

        const active = target.value;
        if (!active) return;

        const section = document.getElementById(sectionName);
        if (!section) return;

        const style = section.querySelector("style");
        if (!style) return;

        style.innerHTML = `
          #${sectionName} > #${active} { display: flex; flex-direction: column; }
          button[value="${active}"] { box-shadow: none; margin-top: 0.5ch; margin-left: 0.5ch; border-color: yellow;}
        `;
      }
    </script>
     <script>
      function getLocal(key) {
        if (!key) return;
        if (typeof key !== "string") return;
        const localStorageKey = key;
        const oldValue = localStorage.getItem(localStorageKey);
        console.log({ oldValue });
        const deserilalized = JSON.parse(oldValue);
        console.log({ deserilalized });
        return deserilalized;
      }
      function setLocal(key, value) {
        if (!key) return;
        if (typeof key !== "string") return;
        if (!value) return;
        if (typeof value !== "object") return;

        const localStorageKey = key;
        const serialized = JSON.stringify(value);
        console.log({ serialized });
        localStorage.setItem(localStorageKey, serialized);
        console.log({ localStorage });
      }
      function persist(event) {
        const container = event.currentTarget;
        if (!container) return;
        console.log({ container });
        const target = event.target;
        if (target.tagName !== "INPUT") return;
        console.log({ target });
        const name = target.name;
        if (!name) return;
        console.log({ name });
        const value = target.value;
        if (!value) return;
        console.log({ value });

        const localStorageKey = container.id;
        if (!localStorageKey) return;
        console.log({ localStorageKey });

        const deserilalized = getLocal(localStorageKey);
        console.log({ deserilalized });
        if (!deserilalized) {
          setLocal(localStorageKey, { [name]: value });
          return;
        }

        deserilalized[name] = value;
        console.log({ deserilalized });
        setLocal(localStorageKey, deserilalized);
        const localStorageValue = getLocal(localStorageKey);
        console.log({ localStorageValue });
      }
    </script>
  </head>

  <body style="margin: 0; border: 1px solid hotpink; min-height: 100vh">
    <main>
     
      <section id="editor" class="active" style="border: 1px solid teal">
        <style id="editor-style">
          #facts {
            display: flex;
            flex-direction: column;
          }
        </style>

        <nav data-section="editor" onclick="navigate(event)">
          <button value="cvs">CVs</button>
          <button value="facts">Facts</button>
          <button value="styles">Styles</button>
          <button value="settings">Settings</button>
        </nav>

        <div id="cvs" class="editor" hidden></div>
        <div id="facts" class="editor" hidden>
          <style id="facts-style"></style>

          <nav data-section="facts" onclick="navigate(event)">
            <button value="personal">Personal</button>
            <button value="contact">Contact</button>
            <button value="summary">Summary</button>
            <button value="education">Education</button>
            <button value="experience">Experience</button>
            <button value="skills">Skills</button>
          </nav>
         
          <div
            id="personal"
            class="facts"
            data-autoload="true"
            hidden
            onchange="persist(event)"
          >
            <label for="first">First Name</label>
            <input type="text" id="first" name="first" />
            <label for="last">Last Name</label>
            <input type="text" id="last" name="last" />
            <label for="location">Location</label>
            <input type="text" id="location" name="location" />
          </div>
          <div
            id="contact"
            class="facts"
            data-autoload="true"
            hidden
            onchange="persist(event)"
          >
            <label for="email">Email</label>
            <input type="email" id="email" name="email" />
            <label for="phone">Phone</label>
            <input type="tel" id="phone" name="phone" />
            <label for="website">Website</label>
            <input type="url" id="website" name="website" />
          </div>
          <div id="summary" class="facts" hidden></div>
          <div id="education" class="facts" hidden></div>
          <div id="experience" class="facts" hidden></div>
          <div id="skills" class="facts" hidden></div>
        </div>
        <div id="styles" class="editor" hidden></div>
        <div id="settings" class="editor" hidden></div>
      </section>
      <section id="preview" style="border: 1px solid yellow"></section>
    </main>
    <script>
      // click the facts button
      const factsButton = document.querySelector('button[value="facts"]');
      if (factsButton) {
        factsButton.click();
      }
      // click the personal button
      const personalButton = document.querySelector('button[value="personal"]');
      if (personalButton) {
        personalButton.click();
      }

      function autoload(container) {
        if (!container) return;

        const deserilalized = getLocal(container.id);
        if (!deserilalized) return;

        for (const [key, value] of Object.entries(deserilalized)) {
          const input = container.querySelector(`input[name="${key}"]`);
          if (!input) continue;
          input.value = value;
        }
      }
      document.addEventListener("DOMContentLoaded", () => {
        const toAutoload = document.querySelectorAll("[data-autoload]");
        toAutoload.forEach((element) => {
          if (element.dataset.autoload === "true") {
            autoload(element);
          }
        });
      });
    </script>
  </body>
</html>
